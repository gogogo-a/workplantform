# RAG å¹³å° API æ¥å£æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0  
> åŸºç¡€è·¯å¾„ï¼š`http://localhost:8000`  
> å“åº”æ ¼å¼ï¼šJSON  
> æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š2025-10-24

---

## ğŸ“‹ ç›®å½•

- [1. ç”¨æˆ·ç®¡ç† API](#1-ç”¨æˆ·ç®¡ç†-api)
- [2. æ–‡æ¡£ç®¡ç† API](#2-æ–‡æ¡£ç®¡ç†-api)
- [3. ä¼šè¯ç®¡ç† API](#3-ä¼šè¯ç®¡ç†-api)
- [4. æ¶ˆæ¯ç®¡ç† API](#4-æ¶ˆæ¯ç®¡ç†-api)
- [5. é€šç”¨å“åº”æ ¼å¼](#5-é€šç”¨å“åº”æ ¼å¼)
- [6. é”™è¯¯ç è¯´æ˜](#6-é”™è¯¯ç è¯´æ˜)

---

## 1. ç”¨æˆ·ç®¡ç† API

åŸºç¡€è·¯å¾„ï¼š`/users`

### 1.1 ç”¨æˆ·æ³¨å†Œ

**æ¥å£æè¿°ï¼š** ç”¨æˆ·æ³¨å†Œï¼Œéœ€è¦é‚®ç®±éªŒè¯ç 

**è¯·æ±‚æ–¹å¼ï¼š** `POST /users`

**è¯·æ±‚å¤´ï¼š**
```http
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| nickname | string | æ˜¯ | æ˜µç§° | é•¿åº¦ 2-50 å­—ç¬¦ |
| email | string | æ˜¯ | é‚®ç®±åœ°å€ | å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ |
| password | string | æ˜¯ | å¯†ç  | æœ€çŸ­ 6 ä½ |
| confirm_password | string | æ˜¯ | ç¡®è®¤å¯†ç  | æœ€çŸ­ 6 ä½ï¼Œéœ€ä¸ password ä¸€è‡´ |
| captcha | string | æ˜¯ | é‚®ç®±éªŒè¯ç  | 6 ä½æ•°å­— |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "nickname": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "password": "123456",
  "confirm_password": "123456",
  "captcha": "123456"
}
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç ï¼ˆ0=æˆåŠŸ, -1=å¤±è´¥ï¼‰ |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| nickname | string | æ˜µç§° |
| email | string | é‚®ç®± |
| avatar | string | å¤´åƒ URL |
| gender | integer | æ€§åˆ«ï¼ˆ0=ç”·, 1=å¥³ï¼‰ |
| birthday | string | ç”Ÿæ—¥ |
| role | integer | è§’è‰²ï¼ˆ0=æ™®é€šç”¨æˆ·, 1=ç®¡ç†å‘˜ï¼‰ |
| created_at | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ |

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "uuid": "550e8400-e29b-41d4-a716-446655440000",
    "nickname": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "avatar": "",
    "gender": 0,
    "birthday": "",
    "role": 0,
    "created_at": "2025-10-24T10:30:00Z"
  }
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": -1,
  "message": "éªŒè¯ç é”™è¯¯"
}
```

---

### 1.2 ç”¨æˆ·ç™»å½•

**æ¥å£æè¿°ï¼š** ä½¿ç”¨æ˜µç§°å’Œå¯†ç ç™»å½•

**è¯·æ±‚æ–¹å¼ï¼š** `POST /users/login`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| nickname | string | æ˜¯ | æ˜µç§° |
| password | string | æ˜¯ | å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "nickname": "å¼ ä¸‰",
  "password": "123456"
}
```

**å“åº”å‚æ•°ï¼š** åŒ [1.1 ç”¨æˆ·æ³¨å†Œ](#11-ç”¨æˆ·æ³¨å†Œ)

---

### 1.3 é‚®ç®±éªŒè¯ç ç™»å½•

**æ¥å£æè¿°ï¼š** ä½¿ç”¨é‚®ç®±å’ŒéªŒè¯ç ç™»å½•

**è¯·æ±‚æ–¹å¼ï¼š** `POST /users/email-login`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| email | string | æ˜¯ | é‚®ç®±åœ°å€ | å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ |
| captcha | string | æ˜¯ | é‚®ç®±éªŒè¯ç  | 6 ä½æ•°å­— |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "email": "zhangsan@example.com",
  "captcha": "123456"
}
```

**å“åº”å‚æ•°ï¼š** åŒ [1.1 ç”¨æˆ·æ³¨å†Œ](#11-ç”¨æˆ·æ³¨å†Œ)

---

### 1.4 è·å–ç”¨æˆ·åˆ—è¡¨

**æ¥å£æè¿°ï¼š** åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨

**è¯·æ±‚æ–¹å¼ï¼š** `GET /users`

**Query å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ | çº¦æŸ |
|--------|------|------|------|--------|------|
| owner_id | string | å¦ | æ‹¥æœ‰è€…IDï¼ˆè¿‡æ»¤ï¼‰ | null | - |
| page | integer | å¦ | é¡µç  | 1 | >= 1 |
| page_size | integer | å¦ | æ¯é¡µæ•°é‡ | 10 | 1-100 |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /users?page=1&page_size=10
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ•°æ®å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| total | integer | æ€»ç”¨æˆ·æ•° |
| users | array | ç”¨æˆ·åˆ—è¡¨ï¼ˆæ¯ä¸ªå…ƒç´ ç»“æ„åŒ 1.1 çš„ dataï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 100,
    "users": [
      {
        "uuid": "550e8400-e29b-41d4-a716-446655440000",
        "nickname": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "avatar": "",
        "gender": 0,
        "birthday": "",
        "role": 0,
        "created_at": "2025-10-24T10:30:00Z"
      }
    ]
  }
}
```

---

### 1.5 è·å–ç”¨æˆ·è¯¦æƒ…

**æ¥å£æè¿°ï¼š** æ ¹æ®ç”¨æˆ· UUID è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚æ–¹å¼ï¼š** `GET /users/{user_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ· UUID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /users/550e8400-e29b-41d4-a716-446655440000
```

**å“åº”å‚æ•°ï¼š** åŒ [1.1 ç”¨æˆ·æ³¨å†Œ](#11-ç”¨æˆ·æ³¨å†Œ)

---

### 1.6 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£æè¿°ï¼š** æ›´æ–°ç”¨æˆ·çš„éƒ¨åˆ†ä¿¡æ¯

**è¯·æ±‚æ–¹å¼ï¼š** `PATCH /users/{user_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ· UUID |

**è¯·æ±‚ä½“å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| nickname | string | å¦ | æ˜µç§° | é•¿åº¦ 2-50 å­—ç¬¦ |
| email | string | å¦ | é‚®ç®±åœ°å€ | å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ |
| avatar | string | å¦ | å¤´åƒ URL | - |
| gender | integer | å¦ | æ€§åˆ« | 0=ç”·, 1=å¥³ |
| birthday | string | å¦ | ç”Ÿæ—¥ | - |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "nickname": "æå››",
  "avatar": "https://example.com/avatar.jpg"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

---

### 1.7 åˆ é™¤å•ä¸ªç”¨æˆ·

**æ¥å£æè¿°ï¼š** åˆ é™¤æŒ‡å®šç”¨æˆ·

**è¯·æ±‚æ–¹å¼ï¼š** `DELETE /users/{user_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ· UUID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
DELETE /users/550e8400-e29b-41d4-a716-446655440000
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ: 1 ä¸ªç”¨æˆ·"
}
```

---

### 1.8 æ‰¹é‡åˆ é™¤ç”¨æˆ·

**æ¥å£æè¿°ï¼š** æ‰¹é‡åˆ é™¤å¤šä¸ªç”¨æˆ·

**è¯·æ±‚æ–¹å¼ï¼š** `DELETE /users/{user_id_list}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id_list | string | æ˜¯ | ç”¨æˆ·UUIDåˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
DELETE /users/550e8400-e29b-41d4-a716-446655440000,550e8400-e29b-41d4-a716-446655440001
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ: 2 ä¸ªç”¨æˆ·"
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- å¤šä¸ªUUIDä¹‹é—´ç”¨é€—å·åˆ†éš”
- ä¼šæ‰¹é‡åˆ é™¤æ‰€æœ‰æŒ‡å®šçš„ç”¨æˆ·
- æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…ä½¿ç”¨

---

### 1.9 è®¾ç½®ç®¡ç†å‘˜

**æ¥å£æè¿°ï¼š** è®¾ç½®æˆ–å–æ¶ˆç”¨æˆ·çš„ç®¡ç†å‘˜æƒé™

**è¯·æ±‚æ–¹å¼ï¼š** `PATCH /users/set-admin`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ·UUID |
| is_admin | boolean | æ˜¯ | æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼ˆtrue=è®¾ç½®ï¼Œfalse=å–æ¶ˆï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "is_admin": true
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è®¾ç½®ç®¡ç†å‘˜æˆåŠŸ: 1 ä¸ªç”¨æˆ·"
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- `is_admin: true` - è®¾ç½®ä¸ºç®¡ç†å‘˜
- `is_admin: false` - å–æ¶ˆç®¡ç†å‘˜æƒé™
- éœ€è¦å½“å‰ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜æƒé™

---

### 1.10 å‘é€é‚®ç®±éªŒè¯ç 

**æ¥å£æè¿°ï¼š** å‘æŒ‡å®šé‚®ç®±å‘é€éªŒè¯ç ï¼ˆç”¨äºæ³¨å†Œæˆ–ç™»å½•ï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `POST /users/email-code`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| email | string | æ˜¯ | é‚®ç®±åœ°å€ | å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "email": "zhangsan@example.com"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "éªŒè¯ç å‘é€æˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ä»¶"
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- éªŒè¯ç æœ‰æ•ˆæœŸ 5 åˆ†é’Ÿ
- åŒä¸€é‚®ç®± 1 åˆ†é’Ÿå†…åªèƒ½å‘é€ 1 æ¬¡
- éªŒè¯ç å­˜å‚¨åœ¨ Redis ä¸­

---

## 2. æ–‡æ¡£ç®¡ç† API

åŸºç¡€è·¯å¾„ï¼š`/documents`

### 2.1 ä¸Šä¼ æ–‡æ¡£

**æ¥å£æè¿°ï¼š** ä¸Šä¼ æ–‡æ¡£å¹¶è‡ªåŠ¨è¿›è¡Œ Embedding å¤„ç†ï¼ˆå¼‚æ­¥ï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `POST /documents`

**è¯·æ±‚å¤´ï¼š**
```http
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| file | File | æ˜¯ | æ–‡æ¡£æ–‡ä»¶ | æ”¯æŒ .pdf, .docx, .txt |

**è¯·æ±‚ç¤ºä¾‹ï¼ˆcURLï¼‰ï¼š**
```bash
curl -X POST http://localhost:8000/documents \
  -F "file=@/path/to/document.pdf"
```

**è¯·æ±‚ç¤ºä¾‹ï¼ˆPythonï¼‰ï¼š**
```python
import requests

with open('document.pdf', 'rb') as f:
    files = {'file': f}
    response = requests.post('http://localhost:8000/documents', files=files)
    print(response.json())
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ–‡æ¡£ä¿¡æ¯å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | æ–‡æ¡£å”¯ä¸€æ ‡è¯† |
| name | string | æ–‡æ¡£åç§° |
| size | integer | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| url | string | æ–‡æ¡£è®¿é—® URL |
| uploaded_at | string | ä¸Šä¼ æ—¶é—´ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "æ–‡æ¡£ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨åå°å¤„ç†",
  "data": {
    "uuid": "650e8400-e29b-41d4-a716-446655440001",
    "name": "æŠ€æœ¯æ–‡æ¡£.pdf",
    "size": 1048576,
    "url": "/uploads/650e8400-e29b-41d4-a716-446655440001.pdf",
    "uploaded_at": "2025-10-24T11:00:00Z"
  }
}
```

**å¤„ç†æµç¨‹ï¼š**
1. ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°
2. è®°å½•åˆ° MongoDB
3. æäº¤åˆ° Kafka è¿›è¡Œå¼‚æ­¥ Embedding
4. å­˜å‚¨å‘é‡åˆ° Milvusï¼ˆåå°å¤„ç†ï¼‰

---

### 2.2 è·å–æ–‡æ¡£åˆ—è¡¨

**æ¥å£æè¿°ï¼š** åˆ†é¡µè·å–æ–‡æ¡£åˆ—è¡¨ï¼Œæ”¯æŒå…³é”®è¯æœç´¢

**è¯·æ±‚æ–¹å¼ï¼š** `GET /documents`

**Query å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ | çº¦æŸ |
|--------|------|------|------|--------|------|
| page | integer | å¦ | é¡µç  | 1 | >= 1 |
| page_size | integer | å¦ | æ¯é¡µæ•°é‡ | 10 | 1-100 |
| keyword | string | å¦ | æœç´¢å…³é”®è¯ï¼ˆæ–‡æ¡£åï¼‰ | null | æ¨¡ç³ŠåŒ¹é… |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /documents?page=1&page_size=10&keyword=æŠ€æœ¯æ–‡æ¡£
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ•°æ®å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| total | integer | æ€»æ–‡æ¡£æ•° |
| documents | array | æ–‡æ¡£åˆ—è¡¨ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**documents æ•°ç»„å…ƒç´ ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | æ–‡æ¡£å”¯ä¸€æ ‡è¯† |
| name | string | æ–‡æ¡£åç§° |
| uploaded_at | string | ä¸Šä¼ æ—¶é—´ |
| chunk_count | integer | æ–‡æœ¬å—æ•°é‡ï¼ˆä» Milvus æŸ¥è¯¢ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 50,
    "documents": [
      {
        "uuid": "650e8400-e29b-41d4-a716-446655440001",
        "name": "æŠ€æœ¯æ–‡æ¡£.pdf",
        "uploaded_at": "2025-10-24T11:00:00Z",
        "chunk_count": 120
      },
      {
        "uuid": "650e8400-e29b-41d4-a716-446655440002",
        "name": "ç”¨æˆ·æ‰‹å†Œ.docx",
        "uploaded_at": "2025-10-24T10:30:00Z",
        "chunk_count": 85
      }
    ]
  }
}
```

---

### 2.3 è·å–æ–‡æ¡£è¯¦æƒ…

**æ¥å£æè¿°ï¼š** è·å–æ–‡æ¡£çš„å®Œæ•´ä¿¡æ¯

**è¯·æ±‚æ–¹å¼ï¼š** `GET /documents/{document_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| document_id | string | æ˜¯ | æ–‡æ¡£ UUID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /documents/650e8400-e29b-41d4-a716-446655440001
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ–‡æ¡£è¯¦ç»†ä¿¡æ¯ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | æ–‡æ¡£å”¯ä¸€æ ‡è¯† |
| name | string | æ–‡æ¡£åç§° |
| size | integer | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| page | integer | æ–‡æ¡£é¡µæ•° |
| url | string | æ–‡æ¡£è®¿é—® URL |
| uploaded_at | string | ä¸Šä¼ æ—¶é—´ |
| chunk_count | integer | æ–‡æœ¬å—æ•°é‡ï¼ˆä» Milvus æŸ¥è¯¢ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "uuid": "650e8400-e29b-41d4-a716-446655440001",
    "name": "æŠ€æœ¯æ–‡æ¡£.pdf",
    "size": 1048576,
    "page": 50,
    "url": "/uploads/650e8400-e29b-41d4-a716-446655440001.pdf",
    "uploaded_at": "2025-10-24T11:00:00Z",
    "chunk_count": 120
  }
}
```

---

### 2.4 åˆ é™¤æ–‡æ¡£

**æ¥å£æè¿°ï¼š** åˆ é™¤æ–‡æ¡£ï¼ˆåŒ…æ‹¬ MongoDB è®°å½•ã€Milvus å‘é‡ã€ç‰©ç†æ–‡ä»¶ï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `DELETE /documents/{document_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| document_id | string | æ˜¯ | æ–‡æ¡£ UUID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
DELETE /documents/650e8400-e29b-41d4-a716-446655440001
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "æ–‡æ¡£åˆ é™¤æˆåŠŸ"
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- åˆ é™¤æ“ä½œä¼šåŒæ—¶åˆ é™¤ï¼š
  - MongoDB ä¸­çš„æ–‡æ¡£è®°å½•
  - Milvus ä¸­çš„æ‰€æœ‰å‘é‡æ•°æ®
  - æœ¬åœ°å­˜å‚¨çš„ç‰©ç†æ–‡ä»¶

---

## 3. ä¼šè¯ç®¡ç† API

åŸºç¡€è·¯å¾„ï¼š`/sessions`

### 3.1 è·å–ä¼šè¯åˆ—è¡¨

**æ¥å£æè¿°ï¼š** è·å–ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `GET /sessions`

**Query å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ | çº¦æŸ |
|--------|------|------|------|--------|------|
| user_id | string | æ˜¯ | ç”¨æˆ· ID | - | - |
| page | integer | å¦ | é¡µç  | 1 | >= 1 |
| page_size | integer | å¦ | æ¯é¡µæ•°é‡ | 20 | 1-100 |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /sessions?user_id=550e8400-e29b-41d4-a716-446655440000&page=1&page_size=20
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ•°æ®å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| total | integer | æ€»ä¼šè¯æ•° |
| sessions | array | ä¼šè¯åˆ—è¡¨ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**sessions æ•°ç»„å…ƒç´ ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | ä¼šè¯å”¯ä¸€æ ‡è¯† |
| user_id | string | ç”¨æˆ· ID |
| name | string | ä¼šè¯åç§° |
| last_message | string | æœ€åä¸€æ¡æ¶ˆæ¯ |
| create_at | string | åˆ›å»ºæ—¶é—´ |
| update_at | string | æ›´æ–°æ—¶é—´ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 15,
    "sessions": [
      {
        "uuid": "750e8400-e29b-41d4-a716-446655440010",
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "name": "RAG æŠ€æœ¯è®¨è®º",
        "last_message": "RAG æ˜¯æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯...",
        "create_at": "2025-10-24T09:00:00Z",
        "update_at": "2025-10-24T11:30:00Z"
      },
      {
        "uuid": "750e8400-e29b-41d4-a716-446655440011",
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "name": "å‘é‡æ•°æ®åº“",
        "last_message": "Milvus æ˜¯ä¸€ä¸ªå¼€æºå‘é‡æ•°æ®åº“...",
        "create_at": "2025-10-23T15:00:00Z",
        "update_at": "2025-10-23T16:20:00Z"
      }
    ]
  }
}
```

---

### 3.2 è·å–ä¼šè¯è¯¦æƒ…

**æ¥å£æè¿°ï¼š** è·å–ä¼šè¯çš„å®Œæ•´ä¿¡æ¯

**è¯·æ±‚æ–¹å¼ï¼š** `GET /sessions/{session_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| session_id | string | æ˜¯ | ä¼šè¯ UUID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /sessions/750e8400-e29b-41d4-a716-446655440010
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ˆç»“æ„åŒ 3.1 çš„ sessions å…ƒç´ ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "uuid": "750e8400-e29b-41d4-a716-446655440010",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "RAG æŠ€æœ¯è®¨è®º",
    "last_message": "RAG æ˜¯æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯...",
    "create_at": "2025-10-24T09:00:00Z",
    "update_at": "2025-10-24T11:30:00Z"
  }
}
```

---

### 3.3 æ›´æ–°ä¼šè¯ä¿¡æ¯

**æ¥å£æè¿°ï¼š** æ›´æ–°ä¼šè¯çš„éƒ¨åˆ†ä¿¡æ¯

**è¯·æ±‚æ–¹å¼ï¼š** `PATCH /sessions/{session_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| session_id | string | æ˜¯ | ä¼šè¯ UUID |

**è¯·æ±‚ä½“å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|------|
| name | string | å¦ | ä¼šè¯åç§° | é•¿åº¦ 1-100 å­—ç¬¦ |
| last_message | string | å¦ | æœ€åä¸€æ¡æ¶ˆæ¯ | - |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "name": "RAG æŠ€æœ¯æ·±åº¦è®¨è®º"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

---

## 4. æ¶ˆæ¯ç®¡ç† API

åŸºç¡€è·¯å¾„ï¼š`/messages`

### 4.1 å‘é€æ¶ˆæ¯å¹¶è·å– AI å›å¤ï¼ˆæµå¼ï¼‰

**æ¥å£æè¿°ï¼š** å‘é€æ¶ˆæ¯å¹¶è‡ªåŠ¨è·å– AI æ™ºèƒ½å›å¤ï¼ˆç»Ÿä¸€æµå¼è¿”å›ï¼Œæ”¯æŒ Agent + RAGï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `POST /messages`

**è¯·æ±‚å¤´ï¼š**
```http
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸ | é»˜è®¤å€¼ |
|--------|------|------|------|------|--------|
| content | string | æ˜¯ | æ¶ˆæ¯å†…å®¹ | æœ€çŸ­ 1 å­—ç¬¦ | - |
| user_id | string | æ˜¯ | ç”¨æˆ· ID | - | - |
| session_id | string | å¦ | ä¼šè¯ ID | ä¸æä¾›åˆ™åˆ›å»ºæ–°ä¼šè¯ | null |
| send_name | string | å¦ | å‘é€è€…æ˜µç§° | - | "ç”¨æˆ·" |
| send_avatar | string | å¦ | å‘é€è€…å¤´åƒ URL | - | "" |
| file_type | string | å¦ | æ–‡ä»¶ç±»å‹ | text/image/file | null |
| file_name | string | å¦ | æ–‡ä»¶å | - | null |
| file_size | string | å¦ | æ–‡ä»¶å¤§å° | - | null |
| show_thinking | boolean | å¦ | æ˜¯å¦æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ | - | false |

**è¯·æ±‚ç¤ºä¾‹ï¼ˆéšè—æ€è€ƒè¿‡ç¨‹ï¼‰ï¼š**
```json
{
  "content": "ä½ å¥½",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "session_id": "750e8400-e29b-41d4-a716-446655440010",
  "show_thinking": false
}
```

**è¯·æ±‚ç¤ºä¾‹ï¼ˆæ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ï¼‰ï¼š**
```json
{
  "content": "ä»€ä¹ˆæ˜¯ RAG æŠ€æœ¯ï¼Ÿ",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "show_thinking": true
}
```

**å“åº”æ ¼å¼ï¼š** SSEï¼ˆServer-Sent Eventsï¼‰æµå¼å“åº”

**å“åº”å¤´ï¼š**
```http
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
```

**SSE äº‹ä»¶ç±»å‹ï¼š**

| äº‹ä»¶ç±»å‹ | è§¦å‘æ¡ä»¶ | æ•°æ®ç»“æ„ | è¯´æ˜ |
|----------|----------|----------|------|
| `session_created` | åˆ›å»ºæ–°ä¼šè¯æ—¶ | `{"session_id": "...", "session_name": "..."}` | ä¼šè¯åˆ›å»ºæˆåŠŸ |
| `user_message_saved` | ç”¨æˆ·æ¶ˆæ¯ä¿å­˜å | `{"uuid": "...", "content": "..."}` | ç”¨æˆ·æ¶ˆæ¯å·²ä¿å­˜åˆ°æ•°æ®åº“ |
| `thought` | Agent æ€è€ƒæ—¶ | `{"content": "..."}` | ä»…å½“ `show_thinking=true` |
| `action` | Agent æ‰§è¡ŒåŠ¨ä½œæ—¶ | `{"content": "..."}` | ä»…å½“ `show_thinking=true` |
| `observation` | å·¥å…·è¿”å›ç»“æœæ—¶ | `{"content": "..."}` | ä»…å½“ `show_thinking=true` |
| `answer_chunk` | AI ç”Ÿæˆç­”æ¡ˆç‰‡æ®µ | `{"content": "..."}` | å®æ—¶è¾“å‡ºï¼Œæ¯ä¸ª token |
| `ai_message_saved` | AI æ¶ˆæ¯ä¿å­˜å | `{"uuid": "...", "content": "..."}` | AI å›å¤å·²ä¿å­˜åˆ°æ•°æ®åº“ |
| `done` | å¯¹è¯å®Œæˆ | `{"session_id": "..."}` | æµå¼è¾“å‡ºç»“æŸ |
| `error` | å‘ç”Ÿé”™è¯¯ | `{"message": "..."}` | é”™è¯¯ä¿¡æ¯ |

**SSE å“åº”æ ¼å¼ï¼š**
```
event: session_created
data: {"session_id": "750e8400-e29b-41d4-a716-446655440010", "session_name": "ä»€ä¹ˆæ˜¯ RAG..."}

event: user_message_saved
data: {"uuid": "850e8400-e29b-41d4-a716-446655440020", "content": "ä»€ä¹ˆæ˜¯ RAG æŠ€æœ¯ï¼Ÿ"}

event: thought
data: {"content": "ç”¨æˆ·è¯¢é—® RAG æŠ€æœ¯ï¼Œéœ€è¦æ£€ç´¢çŸ¥è¯†åº“è·å–æƒå¨ä¿¡æ¯"}

event: action
data: {"content": "knowledge_search(\"RAG æŠ€æœ¯\", 5)"}

event: observation
data: {"content": "æˆåŠŸæ£€ç´¢åˆ° 5 ä¸ªç›¸å…³æ–‡æ¡£ç‰‡æ®µï¼š\n\n1. RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯..."}

event: answer_chunk
data: {"content": "RAG"}

event: answer_chunk
data: {"content": "ï¼ˆ"}

event: answer_chunk
data: {"content": "Retrieval"}

event: answer_chunk
data: {"content": "-Augmented"}

event: answer_chunk
data: {"content": " Generation"}

event: answer_chunk
data: {"content": "ï¼‰"}

event: answer_chunk
data: {"content": "æ˜¯"}

event: answer_chunk
data: {"content": "æ£€ç´¢"}

event: answer_chunk
data: {"content": "å¢å¼º"}

event: answer_chunk
data: {"content": "ç”Ÿæˆ"}

event: answer_chunk
data: {"content": "æŠ€æœ¯"}

event: answer_chunk
data: {"content": "..."}

event: ai_message_saved
data: {"uuid": "850e8400-e29b-41d4-a716-446655440021", "content": "RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯..."}

event: done
data: {"session_id": "750e8400-e29b-41d4-a716-446655440010"}
```

**å®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆPythonï¼‰ï¼š**

**ç¤ºä¾‹ 1ï¼šéšè—æ€è€ƒè¿‡ç¨‹**
```python
import requests
import json

response = requests.post(
    "http://localhost:8000/messages",
    json={
        "content": "ä½ å¥½",
        "user_id": "user_001",
        "show_thinking": False
    },
    stream=True
)

print("AI å›å¤ï¼š", end='')
for line in response.iter_lines():
    if line:
        line_str = line.decode('utf-8')
        if line_str.startswith('event: '):
            event_type = line_str.replace('event: ', '').strip()
        elif line_str.startswith('data: '):
            event_data = json.loads(line_str.replace('data: ', ''))
            
            # åªæ˜¾ç¤ºç­”æ¡ˆç‰‡æ®µ
            if event_type == 'answer_chunk':
                print(event_data['content'], end='', flush=True)

print()  # æ¢è¡Œ
```

**ç¤ºä¾‹ 2ï¼šæ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹**
```python
import requests
import json

response = requests.post(
    "http://localhost:8000/messages",
    json={
        "content": "ä»€ä¹ˆæ˜¯ RAG æŠ€æœ¯ï¼Ÿ",
        "user_id": "user_001",
        "show_thinking": True
    },
    stream=True
)

current_event = None
for line in response.iter_lines():
    if line:
        line_str = line.decode('utf-8')
        if line_str.startswith('event: '):
            current_event = line_str.replace('event: ', '').strip()
        elif line_str.startswith('data: '):
            event_data = json.loads(line_str.replace('data: ', ''))
            
            # æ˜¾ç¤ºä¸åŒç±»å‹çš„äº‹ä»¶
            if current_event == 'thought':
                print(f"\nğŸ’­ æ€è€ƒ: {event_data['content']}")
            elif current_event == 'action':
                print(f"ğŸ”§ åŠ¨ä½œ: {event_data['content']}")
            elif current_event == 'observation':
                print(f"ğŸ‘€ è§‚å¯Ÿ: {event_data['content'][:100]}...")
            elif current_event == 'answer_chunk':
                print(event_data['content'], end='', flush=True)
            elif current_event == 'done':
                print("\nâœ… å®Œæˆ")
```

**å®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆJavaScript/æµè§ˆå™¨ï¼‰ï¼š**
```javascript
const eventSource = new EventSource('/messages?...');

// ç›‘å¬ answer_chunk äº‹ä»¶
eventSource.addEventListener('answer_chunk', (e) => {
    const data = JSON.parse(e.data);
    document.getElementById('answer').innerHTML += data.content;
});

// ç›‘å¬ thought äº‹ä»¶
eventSource.addEventListener('thought', (e) => {
    const data = JSON.parse(e.data);
    console.log('ğŸ’­ æ€è€ƒ:', data.content);
});

// ç›‘å¬ done äº‹ä»¶
eventSource.addEventListener('done', (e) => {
    eventSource.close();
    console.log('âœ… å®Œæˆ');
});

// ç›‘å¬ error äº‹ä»¶
eventSource.addEventListener('error', (e) => {
    const data = JSON.parse(e.data);
    console.error('âŒ é”™è¯¯:', data.message);
    eventSource.close();
});
```

**æ³¨æ„äº‹é¡¹ï¼š**
1. **æµå¼è¾“å‡º**ï¼šå“åº”æ˜¯å®æ—¶æµå¼çš„ï¼Œå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨ SSE æˆ– stream æ–¹å¼æ¥æ”¶
2. **show_thinking å‚æ•°**ï¼š
   - `false`ï¼ˆé»˜è®¤ï¼‰ï¼šåªè¿”å› `answer_chunk`ï¼Œéšè—æ€è€ƒè¿‡ç¨‹
   - `true`ï¼šè¿”å›å®Œæ•´çš„ Agent æ¨ç†è¿‡ç¨‹ï¼ˆThought â†’ Action â†’ Observation â†’ Answerï¼‰
3. **è‡ªåŠ¨åˆ›å»ºä¼šè¯**ï¼šå¦‚æœä¸æä¾› `session_id`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºæ–°ä¼šè¯
4. **Agent + RAG**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ ReAct Agentï¼Œå¿…è¦æ—¶æ£€ç´¢çŸ¥è¯†åº“
5. **çœŸæ­£çš„æµå¼**ï¼šæ¯ä¸ª token ç”Ÿæˆåç«‹å³å‘é€ï¼Œä¸æ˜¯å‡æµå¼

---

### 4.2 è·å–ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯

**æ¥å£æè¿°ï¼š** è·å–æŒ‡å®šä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆåˆ†é¡µï¼‰

**è¯·æ±‚æ–¹å¼ï¼š** `GET /messages/{session_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| session_id | string | æ˜¯ | ä¼šè¯ UUID |

**Query å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ | çº¦æŸ |
|--------|------|------|------|--------|------|
| page | integer | å¦ | é¡µç  | 1 | >= 1 |
| page_size | integer | å¦ | æ¯é¡µæ•°é‡ | 50 | 1-200 |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /messages/750e8400-e29b-41d4-a716-446655440010?page=1&page_size=50
```

**å“åº”å‚æ•°ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | æ•°æ®å¯¹è±¡ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**data å¯¹è±¡ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| total | integer | æ€»æ¶ˆæ¯æ•° |
| messages | array | æ¶ˆæ¯åˆ—è¡¨ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**messages æ•°ç»„å…ƒç´ ç»“æ„ï¼š**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| uuid | string | æ¶ˆæ¯å”¯ä¸€æ ‡è¯† |
| session_id | string | ä¼šè¯ ID |
| content | string | æ¶ˆæ¯å†…å®¹ |
| send_type | integer | å‘é€è€…ç±»å‹ï¼ˆ0=ç”¨æˆ·, 1=AI, 2=ç³»ç»Ÿï¼‰ |
| send_id | string | å‘é€è€… UUID |
| send_name | string | å‘é€è€…æ˜µç§° |
| send_avatar | string | å‘é€è€…å¤´åƒ |
| receive_id | string | æ¥æ”¶è€… UUID |
| file_type | string | æ–‡ä»¶ç±»å‹ |
| file_name | string | æ–‡ä»¶å |
| file_size | string | æ–‡ä»¶å¤§å° |
| status | integer | çŠ¶æ€ï¼ˆ0=æœªå‘é€, 1=å·²å‘é€ï¼‰ |
| created_at | string | åˆ›å»ºæ—¶é—´ |
| send_at | string | å‘é€æ—¶é—´ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 10,
    "messages": [
      {
        "uuid": "850e8400-e29b-41d4-a716-446655440020",
        "session_id": "750e8400-e29b-41d4-a716-446655440010",
        "content": "ä»€ä¹ˆæ˜¯ RAG æŠ€æœ¯ï¼Ÿ",
        "send_type": 0,
        "send_id": "550e8400-e29b-41d4-a716-446655440000",
        "send_name": "å¼ ä¸‰",
        "send_avatar": "",
        "receive_id": "system",
        "file_type": null,
        "file_name": null,
        "file_size": null,
        "status": 1,
        "created_at": "2025-10-24T11:30:00Z",
        "send_at": "2025-10-24T11:30:00Z"
      },
      {
        "uuid": "850e8400-e29b-41d4-a716-446655440021",
        "session_id": "750e8400-e29b-41d4-a716-446655440010",
        "content": "RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯...",
        "send_type": 1,
        "send_id": "system",
        "send_name": "AIåŠ©æ‰‹",
        "send_avatar": "",
        "receive_id": "550e8400-e29b-41d4-a716-446655440000",
        "file_type": null,
        "file_name": null,
        "file_size": null,
        "status": 1,
        "created_at": "2025-10-24T11:30:15Z",
        "send_at": "2025-10-24T11:30:15Z"
      }
    ]
  }
}
```

---

## 5. é€šç”¨å“åº”æ ¼å¼

æ‰€æœ‰éæµå¼æ¥å£çš„å“åº”éƒ½éµå¾ªä»¥ä¸‹ç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "code": 0,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | çŠ¶æ€ç ï¼ˆè¯¦è§ä¸‹æ–¹é”™è¯¯ç è¯´æ˜ï¼‰ |
| message | string | å“åº”æ¶ˆæ¯ï¼Œç”¨äºå±•ç¤ºç»™ç”¨æˆ· |
| data | object/array/null | ä¸šåŠ¡æ•°æ®ï¼Œæ ¹æ®æ¥å£ä¸åŒè€Œä¸åŒ |

---

## 6. é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | å¸¸è§åŸå›  |
|--------|------|----------|
| 0 | æˆåŠŸ | è¯·æ±‚å¤„ç†æˆåŠŸ |
| -1 | å¤±è´¥ | ä¸€èˆ¬ä¸šåŠ¡é”™è¯¯ï¼ˆå…·ä½“åŸå› è§ messageï¼‰ |
| -2 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°ä¸åˆæ³•æˆ–ç¼ºå¤±å¿…å¡«å‚æ•° |
| 200 | æˆåŠŸ | HTTP æˆåŠŸ |
| 400 | è¯·æ±‚é”™è¯¯ | è¯·æ±‚å‚æ•°æ ¼å¼é”™è¯¯ |
| 401 | æœªæˆæƒ | Token æ— æ•ˆæˆ–è¿‡æœŸ |
| 403 | ç¦æ­¢è®¿é—® | æ— æƒé™è®¿é—®è¯¥èµ„æº |
| 404 | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### å¸¸è§é”™è¯¯å“åº”ç¤ºä¾‹

**å‚æ•°é”™è¯¯ï¼š**
```json
{
  "code": -2,
  "message": "å‚æ•°é”™è¯¯ï¼šé‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
}
```

**èµ„æºä¸å­˜åœ¨ï¼š**
```json
{
  "code": 404,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨"
}
```

**ç³»ç»Ÿé”™è¯¯ï¼š**
```json
{
  "code": -1,
  "message": "ç³»ç»Ÿé”™è¯¯"
}
```

---

## 7. é™„å½•

### 7.1 æ—¶é—´æ ¼å¼

æ‰€æœ‰æ—¶é—´å­—æ®µå‡ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼š

```
2025-10-24T11:30:00Z
```

### 7.2 UUID æ ¼å¼

æ‰€æœ‰ UUID å‡ä½¿ç”¨ UUID4 æ ¼å¼ï¼š

```
550e8400-e29b-41d4-a716-446655440000
```

### 7.3 åˆ†é¡µè¯´æ˜

- `page`ï¼šé¡µç ä» 1 å¼€å§‹
- `page_size`ï¼šæ¯é¡µæ•°é‡ï¼Œä¸€èˆ¬æœ€å¤§ä¸º 100ï¼ˆæ¶ˆæ¯æ¥å£ä¸º 200ï¼‰
- `total`ï¼šæ€»è®°å½•æ•°

### 7.4 æ–‡ä»¶å¤§å°å•ä½

æ–‡ä»¶å¤§å°å­—æ®µå‡ä½¿ç”¨å­—èŠ‚ï¼ˆByteï¼‰ä¸ºå•ä½ã€‚

### 7.5 SSEï¼ˆServer-Sent Eventsï¼‰è¯´æ˜

SSE æ˜¯ä¸€ç§æ ‡å‡†çš„ HTTP æµå¼åè®®ï¼Œç”¨äºæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å®æ—¶æ¨é€æ•°æ®ã€‚

**æ ¼å¼ï¼š**
```
event: <äº‹ä»¶ç±»å‹>
data: <JSON æ•°æ®>

```

**æ³¨æ„ï¼š**
- æ¯ä¸ªäº‹ä»¶å—ä»¥ç©ºè¡Œç»“å°¾
- data å­—æ®µå¿…é¡»æ˜¯ JSON æ ¼å¼
- å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨ EventSource API æˆ– stream æ–¹å¼æ¥æ”¶

---

## 8. æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| v1.0 | 2025-10-24 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«ç”¨æˆ·ã€æ–‡æ¡£ã€ä¼šè¯ã€æ¶ˆæ¯ç®¡ç† API |

---

## 9. è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**æŠ€æœ¯æ”¯æŒé‚®ç®±ï¼š** support@example.com  
**é¡¹ç›®åœ°å€ï¼š** https://github.com/example/rag-platform

---

**Â© 2025 RAG å¹³å° API æ–‡æ¡£**

